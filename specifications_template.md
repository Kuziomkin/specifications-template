---
title: PayPal Payment Service
summary: Top up account via PayPal
authors:
    - Dzianis Kuziomkin
date: 2024-10-30
hide:
  - navigation
  - footer
---

# Introduction
This document outlines the business, stakeholder, and solution requirements, as well as the assumptions and risks, for the account funding via PayPal feature. <br>
It is intended for product managers, developers, quality assurance specialists, and other stakeholders. <br>
The text contains many technical terms, which are defined in the Glossary section for further clarity. You can refer to the [Glossary](./glossary.md) for detailed explanations of these terms. 

# Objective and solution concept
This section describes business requirements, success metrics and assumptions.
## Context
Bank X, our customer, aims to increase monthly user activity. They have identified that some of their users utilize the PayPal system in both their business and personal lives. As a result, Bank X wants to offer the option for users to fund their bank accounts via PayPal without incurring any commission.
## Business opportunity
Platform can differentiate itself on the market by offering PayPal payment services as a separate product on its Payment Platform, accessible through a single API. This could give Platform a competitive advantage.
## Success metrics
Within six months of implementation, ten percent of Platform customers subscribed to the PayPal service through the Payment Platform.
## Assumptions
- Customers will be interested in using the PayPal service through the Payment Platform.
- The PayPal service will be easy for customers to use and understand.
- Customers will trust the PayPal service and feel confident using it to fund their bank accounts.
- The Payment Platform will be able to handle the additional traffic and workload generated by the PayPal service.
- The PayPal service will be available and reliable during the implementation period.
- The integration of the PayPal service into the Payment Platform will be successful and will not cause any disruptions or issues.
## Limitations
- The System must provide PayPal money transfer service via single Platform API. 

## User Classes and Characteristics
- End Users - these are the individuals who will be using the system to make payments or receive payments through PayPal.
- Bank - this is a business that accepts payments through PayPal.
- Security Specialists - these are the individuals responsible for ensuring the security of a bank's systems and processes.
- Payment Monitoring Specialists - these are the individuals responsible identifying and preventing fraudulent or unauthorized payment transactions, as well as analyzing and reviewing payment trends and patterns to identify potential risks or vulnerabilities.
- Developers - these are the individuals responsible for integrating PayPal into the system.
- Quality assurance specialists - these are the individuals responsible for testing the PayPal integration to ensure that it is working correctly.

# Project Scope

## Use Case Diagram

```mermaid
---
config:
  layout: dagre
  look: classic
  theme: neutral
---
    flowchart TB
        
        %% define actors
        C[fa:fa-user Client]

        subgraph " "
            direction TB
            %% define features
            A([Authorize API Consumer])
            T([Top Up Account])
            S([Show Order Details])
            CP([Capture Payment For Order])
            CO([Create Order])
            AP([Authorize Payment])
        end
        click A "https://github.com/Kuziomkin/diagrams/blob/main/specification.md#Authorize-API-Consumer" "See Authorize API Consumer Use Case"

        %% define relationships
        C --> A
        C --> T
        C --> S
        T -.include.-> CP
        T -.include.-> CO
        CO -.extend.-> S
        CP -.include.-> AP
      
```

**Product Features**:

- The client can authorize themselves
- The client can top up account via PayPal:
   - Create order
   - Capture payment for order
     - Authorize payment for order
 - The client can fetch order details
   - Show order details
  

## Conceptual Architecture

```mermaid

---
config:
  layout: dagre
  look: classic
  theme: neutral
---
  flowchart TB
  subgraph "Solution Components"

    subgraph "**Bank X**"
      %% define components
      UI["User Interface"]
      BS["Bank Server"]

      %%define relationships
      direction TB
      UI --> BS
    end

    subgraph "**PLATFORM**"
      %% define components
      PP["Payment Platform"]
      CD[("Clients DB")]

      %%define relationships
      direction LR
      PP --> CD
    end

    subgraph "**PayPal**"
      %% define components
      AP["Authorization Page"]
      PA["PayPal Processing"]

      %%define relationships
      direction TB
      PA --> AP
    end

    %%define relationships
    direction TB
    BS --> PP

    %%define relationships
    direction TB
    PP ---> PA
  end
```


  Systems components:

- Bank
    - User Interface
    - Bank Server 
- Platform
    - Payment Platform
    - Clients DataBase
    - Platform API
- PayPal
    - PayPal Processing
    - Authorization Page
    - PayPal API

# System Features
## Use Cases
### Authorize API Consumer
Authorization is the process of determining whether a client or user has the permission to access a specific resource or perform a specific action through an API. This is typically done by verifying that the client or user has the necessary permissions or privileges to access the resource or perform the action.

**Diagram**
---

```mermaid
---
config:
  layout: dagre
  look: classic
  theme: neutral
---
  sequenceDiagram
    autonumber
    participant BS as Bank Server
    box rgb(190,190,200) Platform
    participant PP as Payment Platform
    participant CD as Clients DB
    end
    participant PAP as PayPal Processing

    BS ->>+ PP: send PayPal <br/> service Request
      PP ->> PP: retrieve the signature <br/> from the Request
      PP ->>+ CD: find the Client's public key
      CD -->>- PP: return public key
      PP ->> PP: use public key <br/> to verify signature
      PP ->>+ CD: find the PayPal Client's credentials
      CD -->>- PP: return credentials
        PP ->>+ PAP: generate access token
          PAP ->> PAP: check credentials <br/> generate access token
        PAP -->>- PP: return access token
        Note over PP, PAP: Request to the PayPal <br/> with using the access token
    PP -->>- BS: result
   
```

||Authorize API Consumer|
|---|---|
|**Participants**|Bank Server, Payment Platform, Clients DB, PayPal Processing|
|**Trigger**|Payment Platform accepts PayPal service request|
|**Main Flow**|01: Bank Server sends Request to Payment Platform <br> 02: Payment Platform retrieves the signature from the Authorization header <br> 03: Payment Platform queries Clients DataBase to find Client by using keyId from signature <br> 04: Clients public key returns from Clients DataBase <br> 05: Payment Platform uses the public key to verify the signature <br> 06: Payment Platform queries Clients DataBase to get Clients credentials <br> 07: Clients credentials returns from Clients DataBase <br> 08: Payment Platform sends the request to PayPal Processing to generate access token <br> 09: PayPal Processing checks credentials and generates access token <br> 10: Access token returns to Payment Platform <br> ... <br> 11: Bank Server gets operation result|    
|**Alternative and Negative Flows**| &mdash; Step 02 of the Main flow : There is no signature in the header => Bank Server gets HTTP 400 Bad Request <br> &mdash; Step 05 of the Main flow : Signature verification failed => Bank Server gets HTTP 401 Unauthorized|
|**Result**|Client successfully authorized|

### Top up account via PayPal
Top up a bank account via PayPal service means to transfer funds from a PayPal account to a bank account. <br>
To top up a bank account via PayPal, the individual or business making the top-up will need to have a PayPal account and sufficient funds available in their account to complete the top-up.

**Diagram**
---

```mermaid
---
config:
  layout: dagre
  look: classic
  theme: neutral
---
  sequenceDiagram
    autonumber
    actor EU as End User
    box rgb(190,190,200) Bank
    participant UI as User Interface
    participant BS as Bank Server
    end
    participant PP as Payment Platform
    participant PAP as PayPal Processing

    EU ->>+ UI: top up account via PayPal
      UI ->>+ BS: request to create the order
        BS ->>+ PP: POST /v2/transaction/payments <br/>//request to create the payment
        Note over PP, PAP: Generate Acess Token
          PP ->>+ PAP: POST/v2/checkout/orders <br/>//request to create the order
            PAP ->> PAP:fdfd
```

||Top up account via PayPal|
|---|---|
|**Participants**|End User, User Interface, Bank Server, Payment Platform, PayPal Processing|
|**Trigger**|End User wants to top up account via PayPal|
|**Main Flow**|01: End User enters amount and clicks on the button to top up account via PayPal <br> 02: User Interface sends request to Bank Server to create the order <br> 03: Bank Server sends request to Payment Platform to create the Payment <br> 04: Payment Platform sends request to PayPal Processing to create the order <br> 05: PayPal Processing creates the order <br> 06: PayPal processing returns to Payment Platform HTTP 201 Created code with order identifier, status and link to authorize payment <br> 07: Payment Platform returns to Bank Server HTTP 201 Created code with payment data including order identifier, status and link <br> 08: Bank Server returns to User Interface result with order identifier, status and link<br> 09: User Interface redirects End User to the link to authorize payment <br> 10: End User authorizes payment for the order <br> 11: Authorization Page authorizes payment for the order <br> 12: Authorization Page redirects back End User to the Banks User Interface <br> 13: End User is waiting payment processing <br> 14: User Interface sends request Bank Server to capture payment for order <br> 15: Bank Server sends request to Payment Platform to submit the payment <br> 16: Payment Platform sends request to PayPal Processing to capture payment for order <br> 17: PayPal Ptocessing transfers money from End User account to Bank PayPal account <br> 18: PayPal processing returns to Payment Platform HTTP 201 Created code with order identifier and status <br> 19: Payment Platform returns to Bank Server HTTP 201 Created code with payment data including order identifier and status <br> 20: Bank Server returns result to User Interface <br> 21: User Interface renders operation result to the End User|    
|**Alternative and Negative Flows**| &mdash; Step 04 of the Main flow: Authentication failed due to invalid authentication credentials or a missing Authorization header => PayPal returns HTTP 401 Unauthorized => Payment Platform repeats Generate access token use case and request to PayPal <br> &mdash; Step 16 of the Main flow: Payer has not yet approved the Order for payment => PayPal returns HTTP 422 Unprocessable Entity => Payment Platform returns to Bank HTTP 422 Unprocessable Entity|
|**Result**|Client successfully topped up account via PayPal|
